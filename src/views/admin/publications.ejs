<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= title %> · <%= site.title %></title>

    <!-- Bootstrap + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <link href="/css/styles.css" rel="stylesheet">
    <style>:root{ --brand-green:<%= site.navbar_color || '#1b8f3a' %>; }</style>
  </head>

  <body>
    <!-- NAV -->
    <nav class="navbar navbar-expand-lg" style="background:var(--brand-green);">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2 text-white" href="/">
          <% if(site.logo_url){ %>
            <img src="<%= site.logo_url %>" class="brand-logo" alt="Logo" style="height:34px">
          <% } else { %>
            <strong class="text-white"><%= site.title %></strong>
          <% } %>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
        </div>
      </div>
    </nav>

    <!-- CONTENIDO -->
    <main class="container my-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Publicaciones</h3>
        <a href="/admin" class="btn btn-outline-secondary">Volver al panel</a>
      </div>
<form method="post"
      action="/admin/publicaciones"
      enctype="multipart/form-data"
      class="row g-3 mb-4">

  <div class="col-md-6">
    <label class="form-label">Título</label>
    <input name="title" class="form-control" placeholder="Título" required>
  </div>

  <div class="col-12">
    <label class="form-label">Texto (cuerpo)</label>
    <textarea name="body" rows="4" class="form-control"
              placeholder="Descripción de la publicación"></textarea>
  </div>

   <div class="col-md-3">
          <label class="form-label">URL imagen (opcional)</label>
          <input name="hero_url" class="form-control" placeholder="https://...">
          <small class="text-muted">Si adjuntas varias imágenes, esta será la primera.</small>
        </div>
        <div class="col-md-3">
          <label class="form-label">Archivos imagen</label>
          <input type="file" name="hero_files" class="form-control" accept="image/*" multiple>
          <small class="text-muted">Puedes seleccionar varias imágenes (galería).</small>
        </div>

  <div class="col-md-3">
    <label class="form-label">URL video (opcional)</label>
    <input name="video_url" class="form-control" placeholder="https://...">
  </div>

  <div class="col-md-3">
    <label class="form-label">Archivo video</label>
    <input type="file" name="video_file" class="form-control">
  </div>

  <div class="col-md-3">
    <label class="form-label">Tipo</label>
    <select name="mode" class="form-select">
      <option value="solo" selected>Solo publicidad</option>
      <option value="link_activity">Enlazar a actividad</option>
    </select>
    <div class="form-text">
      Si enlazas, usa un ID de actividad válido.
    </div>
  </div>

  <div class="col-md-3">
    <label class="form-label">ID actividad (si enlaza)</label>
    <input name="activity_id" class="form-control" placeholder="p.ej. act_123">
  </div>

  <div class="col-md-3">
    <label class="form-label">CTA Label (opcional)</label>
    <input name="cta_label" class="form-control" placeholder="Reservar / Ver actividad">
  </div>

  <div class="col-md-3">
    <label class="form-label">CTA URL (opcional)</label>
    <input name="cta_url" class="form-control"
           placeholder="(si no hay ID, puedes poner URL)">
  </div>

  <div class="col-md-3">
    <label class="form-label">Estado</label>
    <select name="published" class="form-select">
      <option value="1" selected>Publicar</option>
      <option value="0">No mostrar (borrador)</option>
    </select>
  </div>

  <div class="col-md-3 d-flex align-items-end">
    <div class="form-check form-switch">
      <input class="form-check-input"
             type="checkbox"
             id="home_carousel"
             name="home_carousel"
             value="1">
      <label class="form-check-label" for="home_carousel">
        Mostrar en Home (carousel)
      </label>
    </div>
  </div>

  <div class="col-md-3 d-flex align-items-end">
    <button class="btn btn-primary w-100">Agregar</button>
  </div>
</form>

      <!-- Listado -->
      <h2 class="h5 mt-4">Publicación</h2>

<table class="table align-middle">
  <thead>
    <tr>
      <th>Publicación</th>
      <th>Tipo</th>
      <th>Carousel</th>
      <th>Acción</th>
    </tr>
  </thead>
  <tbody>
    <% pubs.forEach(function(pub){ %>
      <tr>
        <td style="max-width:480px;">
          <strong><%= pub.title %></strong><br>
          <small class="text-muted d-block">
            <%= (pub.body || '').slice(0, 200) %>
          </small>
        </td>

        <td>
          <% if (pub.is_linked) { %>
            <span class="badge bg-success">Enlaza actividad</span>
          <% } else { %>
            <span class="badge bg-secondary">Solo publicidad</span>
          <% } %>
        </td>

        <td>
          <form method="post"
                action="/admin/publicaciones/<%= pub.id %>/toggle-home"
                class="d-inline">
            <button type="submit"
                    class="btn btn-sm <%= pub.home_carousel ? 'btn-success' : 'btn-outline-secondary' %>">
              <%= pub.home_carousel ? 'En Home' : 'No en Home' %>
            </button>
          </form>
        </td>

        <td>
          <form method="post"
                action="/admin/publicaciones/<%= pub.id %>/delete"
                class="d-inline"
                onsubmit="return confirm('¿Eliminar esta publicación?');">
            <button class="btn btn-sm btn-danger">Eliminar</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

      <a href="/admin" class="btn btn-primary admin-back">Volver al panel</a>
    </main>

    <!-- FOOTER con mismo color + íconos -->
    <footer class="site-footer text-white mt-4" style="background:var(--brand-green);">
  <div class="container py-3">
    <div class="row g-3 align-items-center">
      <div class="col-md-6 d-flex align-items-center gap-3">
        <% if (site.logo_url) { %>
          <a href="/" class="d-inline-block"><img src="<%= site.logo_url %>" alt="Logo" style="height:40px"></a>
        <% } else { %>
          <strong><%= site.title %></strong>
        <% } %>
        <div class="small">
          <% if (site.phone) { %><strong>Tel:</strong> <%= site.phone %><% } %><br>
          <span class="text-white-50">
            <%= site.privacy_text || '© Todos los derechos reservados. Privacidad: tus datos se usan solo para gestionar reservas.' %>
          </span>
        </div>
      </div>
      <div class="col-md-6 text-md-end">
        <% if (site.facebook_url) { %>
          <a class="text-white fs-5 me-3" href="<%= site.facebook_url %>" target="_blank" aria-label="Facebook">
            <i class="bi bi-facebook"></i>
          </a>
        <% } %>
        <% if (site.instagram_url) { %>
          <a class="text-white fs-5 me-3" href="<%= site.instagram_url %>" target="_blank" aria-label="Instagram">
            <i class="bi bi-instagram"></i>
          </a>
        <% } %>
        <% if (site.tiktok_url) { %>
          <a class="text-white fs-5" href="<%= site.tiktok_url %>" target="_blank" aria-label="TikTok">
            <i class="bi bi-tiktok"></i>
          </a>
        <% } %>
      </div>
    </div>
  </div>
</footer>


    <script>
      // Sincroniza mode -> is_linked (compatibilidad backend)
      const modeSel = document.getElementById('mode');
      const isLinked = document.getElementById('is_linked');
      function syncLink() { isLinked.value = (modeSel.value === 'link' ? '1' : '0'); }
      modeSel.addEventListener('change', syncLink);
      syncLink();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
